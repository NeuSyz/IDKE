##  GCN实现知识图谱中链接预测和实体分类
源自论文：Modeling Relational Data with Graph Convolutional Networks

### 1. 概述
当前预测知识库中的缺失信息是统计关系学习的主要内容。假设知识库主要以三元组的形式（主语、谓语、宾语）进行存储。比如说，Mikhail 在 Vaganova 学院上学，我们把 Mikhail 和 Vaganova 学院称为实体，受教育称为关系，每个实体会有自己的类型，这样便构成一张知识网络。
论文采用关系图卷积网络(R-GCNs)应用到两个标准的知识库推理任务：**链接预测**和**实体分类**，其目的是为了补全知识图谱中的缺失信息。这篇论文主要有两大贡献：
* 证明了GCN可以应用于关系网络(知识图谱)中，特别是链接预测和实体分类中。
* 引入权值共享和系数约束的方法使得R-GCN可以应用于关系众多的网络。

### 2. 实现原理

针对两类任务，论文设计了设计了一个编码器模型，将其应用到两个任务：

* 实体分类模型：将在编码器后面接一个 softmax 分类器用于预测节点的标签
* 链接预测模型：可以后面接一个解码器，将分类器视为自编码器，从而完成节点的预测。


#### 2.1 RGCN

首先，目前的GCN可以视为一种简单可微的消息传递框架(**源自空域卷积的MPNN**)的特殊情况，函数g表示消息传入，典型代表是类似神经网络的映射函数即g(.,.)=W*h，$h_i^l$表示隐藏层l的节点$v_i$，如下式：

$$
h_{i}^{l+1}=\sigma (\sum g_{m}(h_{i}^{l},h_{j}^{l}))
$$

写具体一点，建立了如下的前向网络传播模型，c是用于归一化常量，$N_i^r$表示节点i在关系r下的邻居节点的集合：
$$
h_{i}^{l+1}=\sigma (\sum_{r \in R} \sum_{j \in N_i^r} \frac{1}{c_{i,r}} W_{r}^{l}h_{j}^{l}+ W_{0}^{l}h_{i}^{l})
$$

从上面公式能得到一下几点信息：
* R-GCN 的每层节点特征都是由上一层节点特征和节点的关系（边）得到；
* R-GCN 对节点的邻居节点特征和自身特征进行加权求和得到新的特征；
* R-GCN 为了保留节点自身的信息，会考虑自环。

与 GCN 不同的地方在于 R-GCN 会考虑**边的类型和方向**。在实践中，利用稀疏矩阵乘法可以有效地实现前向传播，同时为了避免了对邻域的显式求和，可以将多层堆叠起来，以便跨多个关系步骤实现依赖关系。


此外为了应对多关系数据增长给模型带来的过拟合现象，采用两个规范化每一层权重W的方法：basis(基函数分解)和block-diagonal分解法(块对角分解)，如下式：
$$
basis: W_{r}^{l}=\sum_{b} \alpha_{rb}^{l}V_{b}^{l}
$$
$$
block-diagonal: W_{r}^{l}=diag(Q_{1r}^{l},...,Q_{Br}^{l})
$$
基函数分解可以看作是不同关系类型之间权重共享的一种方式；而块分解可以看作是对每个关系类型的权值矩阵的稀疏约束，其核心在于潜在的特征可以被分解成一组变量，这些变量在组内的耦合比在组间的耦合更紧密。

两种分解都减少了网络的参数数量。同时，参数化也可以缓解对稀有关系的过度拟合，因为稀有关系和常见关系之间共享参数更新。

#### 2.2 实体分类
对于实体分类来说，只使用了堆叠的 R-GCN 并在最后一层叠加了一个 Softmax 层用于分类，并考虑交叉熵损失函数。

#### 2.3 链路预测
知识库通常是一个有向有标签的图G=(V,E,R)，V 表示节点，E 表示边，R 为关系。通常 E 是不完整，这里我们的目标就是预测缺失的边。实际是预测一个三元组(s,r,o)，通过评分函数f(s,r,o)判断三元组是否满足事实。
实际是将RGCN作为encoder来产生潜在特征表示，张量因子分解模型作为一种decoder来挖掘表征预测边，其中因子分解方法采用**DistMult**(评分函数)。之后来优化经过负采样的交叉熵损失函数。